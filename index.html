<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Time Organizer</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/css/alertify.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/css/themes/default.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/alertify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body.dark {
            background-color: #121212;
        }
        .dark .dark\:bg-custom-dark {
            background-color: #1a1a2e;
        }
        .dark .dark\:bg-custom-card {
            background-color: #16213e;
        }
        .dark .dark\:text-custom-light {
            color: #e2e8f0;
        }
        .dark .dark\:border-custom-border {
            border-color: #2a2a4a;
        }
        .progress-gradient {
            background: linear-gradient(90deg, #3B82F6 0%, #10B981 100%);
        }
        .dark .dark\:previous-button {
            background-color: #374151;
            color: #ffffff;
        }
        .dark .dark\:previous-button:hover {
            background-color: #4B5563;
        }
        .dark .theme-toggle {
            color: #ffffff;
        }
    </style>
</head>
<body class="transition-colors duration-200 bg-gray-50 dark:bg-custom-dark min-h-screen">
    <!-- Navbar -->
    <nav id="navbar" class="fixed w-full top-0 z-50 shadow-md transition-colors duration-200 bg-white dark:bg-custom-dark">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-bold dark:text-custom-light">Study Time Organizer</h1>
            <div class="flex items-center space-x-4">
                <span id="userDisplay" class="dark:text-custom-light hidden"></span>
                <button id="themeToggle" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 theme-toggle hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    Toggle Theme
                </button>
                <button id="signOutBtn" class="px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600 transition-colors hidden">
                    Sign Out
                </button>
            </div>
        </div>
    </nav>

    <!-- Login Form -->
    <div id="loginForm" class="container mx-auto p-8 pt-20">
        <div class="max-w-md mx-auto bg-white dark:bg-custom-card rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-6 dark:text-custom-light">Welcome to Study Time Organizer</h2>
            <div class="space-y-4">
                <input 
                    type="text" 
                    id="username" 
                    placeholder="Enter your username"
                    class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white"
                >
                <button 
                    id="loginBtn"
                    class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                >
                    Sign In
                </button>
            </div>
        </div>
    </div>

    <!-- History View -->
    <div id="historyView" class="container mx-auto p-8 pt-20 hidden">
        <div class="bg-white dark:bg-custom-card rounded-xl shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold dark:text-custom-light">Study History</h2>
                <button onclick="closeHistory()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors dark:text-custom-light">
                    Close
                </button>
            </div>
            
            <!-- Analytics Charts -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                    <h3 class="text-lg font-semibold mb-4 dark:text-custom-light">Study Time by Day</h3>
                    <canvas id="timeChart"></canvas>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                    <h3 class="text-lg font-semibold mb-4 dark:text-custom-light">Task Completion Rate</h3>
                    <canvas id="taskChart"></canvas>
                </div>
            </div>

            <!-- Session History List -->
            <div id="sessionsList" class="space-y-4">
                <!-- Sessions will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Setup Form -->
    <div id="setupForm" class="container mx-auto p-8 hidden">
        <div class="bg-white dark:bg-custom-card rounded-xl shadow-lg p-6">
            <div id="timerSetup" class="hidden">
                <h3 class="text-xl font-bold mb-4 dark:text-custom-light">Set Timer Duration</h3>
                <input type="number" id="hours" placeholder="Hours" class="mr-2 p-2 border rounded dark:bg-gray-700 dark:text-white">
                <input type="number" id="minutes" placeholder="Minutes" class="p-2 border rounded dark:bg-gray-700 dark:text-white">
            </div>

            <div class="mt-6">
                <h3 class="text-xl font-bold mb-4 dark:text-custom-light">Break Mode</h3>
                <select id="breakMode" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white">
                    <option value="pomodoro">25min work / 5min break</option>
                    <option value="long">60min work / 15min break</option>
                    <option value="none">No breaks</option>
                </select>
            </div>

            <div class="mt-6">
                <h3 class="text-xl font-bold mb-4 dark:text-custom-light">Task View Mode</h3>
                <select id="taskViewMode" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white">
                    <option value="all">Show all tasks</option>
                    <option value="focus">Focus mode (one task at a time)</option>
                </select>
            </div>

            <div class="mt-6">
                <h3 class="text-xl font-bold mb-4 dark:text-custom-light">Tasks</h3>
                <div id="taskList" class="space-y-4"></div>
                <button onclick="addMainTask()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                    Add Main Task
                </button>
            </div>

            <button onclick="startSession()" class="mt-6 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors w-full">
                Start Session
            </button>
        </div>
    </div>

    <!-- Session View -->
    <div id="sessionView" class="container mx-auto p-8 hidden">
        <div class="bg-white dark:bg-custom-card rounded-xl shadow-lg p-6">
            <div class="text-center mb-6">
                <h2 id="timeDisplay" class="text-5xl font-bold dark:text-custom-light mb-4">00:00:00</h2>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-3 dark:bg-gray-700">
                        <div id="timeProgress" class="progress-gradient h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="flex justify-center space-x-4 mb-6">
                <button id="startPauseBtn" onclick="toggleTimer()" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                    Start
                </button>
                <button onclick="resetSession()" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                    Reset
                </button>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-bold mb-4 dark:text-custom-light">Task Progress</h3>
                <div class="w-full bg-gray-200 rounded-full h-3 dark:bg-gray-700">
                    <div id="taskProgress" class="progress-gradient h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <div id="taskDisplay" class="space-y-4"></div>

            <button onclick="completeSession()" class="mt-6 px-6 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors w-full">
                Complete Everything
            </button>
        </div>
    </div>

    <!-- Report View -->
    <div id="reportView" class="container mx-auto p-8 hidden">
        <div class="bg-white dark:bg-custom-card rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-6 dark:text-custom-light">Session Report</h2>
            <div id="reportContent" class="space-y-4"></div>
            <div class="mt-6 flex space-x-4">
                <button onclick="downloadReport()" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex-1">
                    Download PDF
                </button>
                <button onclick="startNewSession()" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex-1">
                    Start New Session
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let state = {
            mode: null,
            darkMode: localStorage.getItem('darkMode') === 'true',
            tasks: [],
            currentTask: 0,
            timer: null,
            startTime: null,
            totalTime: 0,
            elapsedTime: 0,
            paused: true,
            taskTimes: {},
            breakMode: null,
            nextBreak: null,
            nextReminder: Date.now() + 30 * 60 * 1000,
            nextMealReminder: Date.now() + 2 * 60 * 60 * 1000
        };

        // User Management System
        const UserManager = {
            currentUser: null,

            init() {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                    this.updateUIForLoggedInUser();
                    return true;
                }
                return false;
            },

            signIn(username) {
                if (!username) {
                    alertify.error('Please enter a username');
                    return false;
                }
                
                const userData = {
                    username,
                    id: Date.now(),
                    joinedDate: new Date().toISOString()
                };
                this.currentUser = userData;
                localStorage.setItem('currentUser', JSON.stringify(userData));
                this.updateUIForLoggedInUser();
                return true;
            },

            signOut() {
                this.currentUser = null;
                localStorage.removeItem('currentUser');
                localStorage.removeItem('currentSession');
                window.location.reload();
            },

            updateUIForLoggedInUser() {
                if (this.currentUser) {
                    document.getElementById('userDisplay').textContent = `Welcome, ${this.currentUser.username}`;
                    document.getElementById('userDisplay').classList.remove('hidden');
                    document.getElementById('signOutBtn').classList.remove('hidden');
                    document.getElementById('loginForm').classList.add('hidden');
                    document.getElementById('modeSelection').classList.remove('hidden');
                }
            }
        };

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize theme
            if (state.darkMode) {
                document.body.classList.add('dark');
            }

            // Theme toggle button
            document.getElementById('themeToggle').addEventListener('click', () => {
                state.darkMode = !state.darkMode;
                document.body.classList.toggle('dark');
                localStorage.setItem('darkMode', state.darkMode);
            });

            // Login button
            document.getElementById('loginBtn').addEventListener('click', () => {
                const username = document.getElementById('username').value.trim();
                UserManager.signIn(username);
            });

            // Sign out button
            document.getElementById('signOutBtn').addEventListener('click', () => {
                UserManager.signOut();
            });

            // Enter key on username input
            document.getElementById('username').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const username = e.target.value.trim();
                    UserManager.signIn(username);
                }
            });

            // Initialize user session
            UserManager.init();
        });
        
        // Session Manager
        const SessionManager = {
            currentSession: null,
            savedSessions: [],
        
            initSession(mode, tasks, breakMode) {
                this.currentSession = {
                    id: Date.now(),
                    userId: UserManager.currentUser?.id,
                    mode,
                    tasks,
                    breakMode,
                    startTime: null,
                    endTime: null,
                    totalTime: 0,
                    elapsedTime: 0,
                    paused: true,
                    taskTimes: {},
                    timestamps: {
                        pauses: [],
                        breaks: []
                    }
                };
                this.saveCurrentSession();
            },
        
            saveCurrentSession() {
                if (this.currentSession) {
                    localStorage.setItem('currentSession', JSON.stringify(this.currentSession));
                }
            },
        
            loadCurrentSession() {
                const savedSession = localStorage.getItem('currentSession');
                if (savedSession) {
                    this.currentSession = JSON.parse(savedSession);
                    return true;
                }
                return false;
            },
        
            clearCurrentSession() {
                this.currentSession = null;
                localStorage.removeItem('currentSession');
            },
        
            completeSession() {
                if (this.currentSession) {
                    this.currentSession.endTime = new Date().toISOString();
                    this.savedSessions.push(this.currentSession);
                    this.saveSessions();
                    this.clearCurrentSession();
                }
            },
        
            saveSessions() {
                if (UserManager.currentUser) {
                    localStorage.setItem(
                        `sessions_${UserManager.currentUser.id}`,
                        JSON.stringify(this.savedSessions)
                    );
                }
            },
        
            loadSavedSessions() {
                if (UserManager.currentUser) {
                    const saved = localStorage.getItem(`sessions_${UserManager.currentUser.id}`);
                    if (saved) {
                        this.savedSessions = JSON.parse(saved);
                    }
                }
            }
        };
        
        // Analytics Manager
        const AnalyticsManager = {
            initCharts() {
                this.createTimeChart();
                this.createTaskChart();
            },
        
            createTimeChart() {
                const ctx = document.getElementById('timeChart').getContext('2d');
                const data = this.getTimeChartData();
                
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'Study Hours',
                            data: data.values,
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            },
        
            createTaskChart() {
                const ctx = document.getElementById('taskChart').getContext('2d');
                const data = this.getTaskCompletionData();
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'Completion Rate (%)',
                            data: data.values,
                            backgroundColor: 'rgba(16, 185, 129, 0.5)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            },
        
            getTimeChartData() {
                const sessions = SessionManager.savedSessions;
                const lastWeek = {};
                
                // Initialize last 7 days
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toLocaleDateString('en-US', { weekday: 'short' });
                    lastWeek[dateStr] = 0;
                }
        
                // Aggregate session times
                sessions.forEach(session => {
                    const date = new Date(session.endTime);
                    const dateStr = date.toLocaleDateString('en-US', { weekday: 'short' });
                    if (lastWeek.hasOwnProperty(dateStr)) {
                        lastWeek[dateStr] += session.elapsedTime / (1000 * 60 * 60); // Convert to hours
                    }
                });
        
                return {
                    labels: Object.keys(lastWeek),
                    values: Object.values(lastWeek)
                };
            },
        
            getTaskCompletionData() {
                const sessions = SessionManager.savedSessions;
                const completionRates = sessions.map(session => {
                    const totalTasks = session.tasks.reduce((acc, task) => 
                        acc + task.subtasks.length + 1, 0);
                    const completedTasks = session.tasks.reduce((acc, task) => 
                        acc + (task.completed ? task.subtasks.length + 1 : 
                            task.subtasks.filter(st => st.completed).length), 0);
                    return (completedTasks / totalTasks) * 100;
                });
        
                return {
                    labels: sessions.map((_, index) => `Session ${index + 1}`),
                    values: completionRates
                };
            }
        };
        
        // Event Handlers
        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            if (username) {
                UserManager.signIn(username);
                SessionManager.loadSavedSessions();
            } else {
                alertify.error('Please enter a username');
            }
        }
        
        function showHistory() {
            document.getElementById('modeSelection').classList.add('hidden');
            document.getElementById('setupForm').classList.add('hidden');
            document.getElementById('sessionView').classList.add('hidden');
            document.getElementById('reportView').classList.add('hidden');
            document.getElementById('historyView').classList.remove('hidden');
            
            renderSessionHistory();
            AnalyticsManager.initCharts();
        }
        
        function closeHistory() {
            document.getElementById('historyView').classList.add('hidden');
            document.getElementById('modeSelection').classList.remove('hidden');
        }
        
        function renderSessionHistory() {
            const sessionsList = document.getElementById('sessionsList');
            sessionsList.innerHTML = SessionManager.savedSessions.map((session, index) => `
                <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-lg font-semibold dark:text-custom-light">Session ${index + 1}</h4>
                        <span class="text-sm text-gray-500 dark:text-gray-400">
                            ${new Date(session.startTime).toLocaleDateString()}
                        </span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm dark:text-gray-300">Duration: ${formatTime(session.elapsedTime)}</p>
                            <p class="text-sm dark:text-gray-300">Mode: ${session.mode}</p>
                    <p class="text-sm dark:text-gray-300">Break Mode: ${session.breakMode}</p>
                </div>
                <div>
                    <p class="text-sm dark:text-gray-300">Tasks Completed: ${
                        session.tasks.filter(t => t.completed).length
                    }/${session.tasks.length}</p>
                    <p class="text-sm dark:text-gray-300">Subtasks Completed: ${
                        session.tasks.reduce((acc, task) => 
                            acc + task.subtasks.filter(st => st.completed).length, 0
                    )}/${
                        session.tasks.reduce((acc, task) => 
                            acc + task.subtasks.length, 0
                    }</p>
                </div>
            </div>
        </div>
    `).join('');
}

// Modify existing functions to work with session management

function selectMode(mode) {
    state.mode = mode;
    document.getElementById('modeSelection').classList.add('hidden');
    document.getElementById('setupForm').classList.remove('hidden');
    if (mode === 'timer') {
        document.getElementById('timerSetup').classList.remove('hidden');
    }
}

function startSession() {
    if (!UserManager.currentUser) {
        alertify.error('Please sign in to start a session');
        return;
    }

    if (state.mode === 'timer') {
        const hours = parseInt(document.getElementById('hours').value) || 0;
        const minutes = parseInt(document.getElementById('minutes').value) || 0;
        state.totalTime = (hours * 60 + minutes) * 60 * 1000;
        if (state.totalTime <= 0) {
            alertify.error('Please set a valid time duration');
            return;
        }
    }

    state.breakMode = document.getElementById('breakMode').value;
    state.taskViewMode = document.getElementById('taskViewMode').value;

    if (state.tasks.length === 0) {
        alertify.error('Please add at least one task');
        return;
    }

    // Initialize session in SessionManager
    SessionManager.initSession(state.mode, state.tasks, state.breakMode);
    
    document.getElementById('setupForm').classList.add('hidden');
    document.getElementById('sessionView').classList.remove('hidden');
    renderTaskDisplay();
    updateProgress();

    // Automatically start the timer when session starts
    state.startTime = Date.now();
    state.timer = setInterval(updateTimer, 1000);
    state.paused = false;
    document.getElementById('startPauseBtn').textContent = 'Pause';
    document.getElementById('startPauseBtn').classList.replace('bg-green-500', 'bg-yellow-500');
}

function toggleTimer() {
    if (state.paused) {
        state.startTime = Date.now() - state.elapsedTime;
        state.timer = setInterval(updateTimer, 1000);
        document.getElementById('startPauseBtn').textContent = 'Pause';
        document.getElementById('startPauseBtn').classList.replace('bg-green-500', 'bg-yellow-500');
    } else {
        clearInterval(state.timer);
        state.elapsedTime = Date.now() - state.startTime;
        document.getElementById('startPauseBtn').textContent = 'Resume';
        document.getElementById('startPauseBtn').classList.replace('bg-yellow-500', 'bg-green-500');
        
        // Save pause timestamp
        if (SessionManager.currentSession) {
            SessionManager.currentSession.timestamps.pauses.push({
                time: new Date().toISOString(),
                elapsedTime: state.elapsedTime
            });
            SessionManager.saveCurrentSession();
        }
    }
    state.paused = !state.paused;
}

function updateTimer() {
    state.elapsedTime = Date.now() - state.startTime;
    const timeDisplay = document.getElementById('timeDisplay');
    
    if (state.mode === 'timer') {
        const remainingTime = state.totalTime - state.elapsedTime;
        if (remainingTime <= 0) {
            clearInterval(state.timer);
            if (!allTasksCompleted()) {
                alertify.confirm(
                    'Time\'s Up!',
                    'You still have incomplete tasks. Would you like to extend the timer?',
                    function() {
                        state.totalTime += 30 * 60 * 1000; // Add 30 minutes
                        state.timer = setInterval(updateTimer, 1000);
                    },
                    function() {
                        completeSession();
                    }
                );
            } else {
                completeSession();
            }
        }
        
        const hours = Math.floor(remainingTime / (60 * 60 * 1000));
        const minutes = Math.floor((remainingTime % (60 * 60 * 1000)) / (60 * 1000));
        const seconds = Math.floor((remainingTime % (60 * 1000)) / 1000);
        timeDisplay.textContent = `${String(Math.max(0, hours)).padStart(2, '0')}:${String(Math.max(0, minutes)).padStart(2, '0')}:${String(Math.max(0, seconds)).padStart(2, '0')}`;
        
        const progress = ((state.totalTime - remainingTime) / state.totalTime) * 100;
        document.getElementById('timeProgress').style.width = `${Math.min(progress, 100)}%`;
    } else {
        const hours = Math.floor(state.elapsedTime / (60 * 60 * 1000));
        const minutes = Math.floor((state.elapsedTime % (60 * 60 * 1000)) / (60 * 1000));
        const seconds = Math.floor((state.elapsedTime % (60 * 1000)) / 1000);
        timeDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    if (SessionManager.currentSession) {
        SessionManager.currentSession.elapsedTime = state.elapsedTime;
        SessionManager.saveCurrentSession();
    }

    checkForBreak();
    checkReminders();
}

function toggleTaskCompletion(taskId, subtaskId = null) {
    const task = state.tasks.find(t => t.id === taskId);
    if (!task) return;

    if (subtaskId === null) {
        task.completed = !task.completed;
        task.subtasks.forEach(st => st.completed = task.completed);
    } else {
        const subtask = task.subtasks.find(st => st.id === subtaskId);
        if (subtask) {
            subtask.completed = !subtask.completed;
            task.completed = task.subtasks.every(st => st.completed);
        }
    }

    // Update session data
    if (SessionManager.currentSession) {
        SessionManager.currentSession.tasks = state.tasks;
        SessionManager.saveCurrentSession();
    }

    renderTaskDisplay();
    updateProgress();

    if (allTasksCompleted() && state.mode === 'timer' && 
        (state.totalTime - state.elapsedTime) > 0) {
        alertify.success('Congratulations! You completed all tasks ahead of schedule!');
    }
}

function completeSession() {
    clearInterval(state.timer);
    SessionManager.completeSession();
    document.getElementById('sessionView').classList.add('hidden');
    document.getElementById('reportView').classList.remove('hidden');
    document.getElementById('reportContent').innerHTML = generateReport();
}

// Initialize everything when the page loads
document.addEventListener('DOMContentLoaded', () => {
    // Set up event listeners
    document.getElementById('historyBtn').addEventListener('click', showHistory);
    document.getElementById('signOutBtn').addEventListener('click', () => UserManager.signOut());
    
    // Initialize user session
    const isLoggedIn = UserManager.init();
    if (isLoggedIn) {
        SessionManager.loadSavedSessions();
        // Check for existing session
        if (SessionManager.loadCurrentSession()) {
            state = { ...state, ...SessionManager.currentSession };
            document.getElementById('modeSelection').classList.add('hidden');
            document.getElementById('sessionView').classList.remove('hidden');
            renderTaskDisplay();
            updateProgress();
            if (!state.paused) {
                state.startTime = Date.now() - state.elapsedTime;
                state.timer = setInterval(updateTimer, 1000);
            }
        }
    }
});

</script>
</body>
</html>